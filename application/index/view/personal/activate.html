{include file="index@Index/header"}


<body style="background: #f4f4f4;">
<!-- 顶部 -->
<div id="header">
    <div class="header-left">
        <span class="iconfont icon-fanhui"></span>
    </div>
    <div class="header-content">资产激活</div>
    <div class="header-right">
    </div>
</div>

<!-- 内容 -->
<div class="content">
    <form id="forms" action="" method="">
        <div class="weui-cells weui-cells_form">
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label">现有资产</label></div>
                <div class="weui-cell__bd">
                    <span>{$member['asset']}</span>
                </div>
            </div>

            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label">激活资产</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input" type="number" name="" value="" placeholder="请输入激活资产">
                </div>
            </div>
        </div>

        <div class="form-btn">
            <button class="weui-btn weui-btn_primary" type="submit">确认</button>
        </div>
    </form>
</div>
{include file="index@Index/floor"}

<script src="/static/member/js/ajax.js"></script>
<script>
    $('.icon-fanhui').on('click', function(){
        location.href = '/index-personal';
    });

    $('#forms').off('submit').on('submit', function(){
        var str = '';
        if( $('.num').val() == '' ) str += '请输入激活资产数量 ';
        if( str == '' ){
            Ajax($(this), deal);
        }else{
            $.alert(str);
        }
        return false;
    });

    function deal( resp ){
        console.log('123');
    }

    var wechat_data = {};
    var getStatus = null;
    //支付判断是否在微信浏览器内
    function moneyPay() {
        if (typeof WeixinJSBridge == "undefined") {
            if (document.addEventListener) {
                document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
            } else if (document.attachEvent) {
                document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
                document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
            }
        } else {
            onBridgeReady();
        }
    }

    //微信支付
    function onBridgeReady() {
        //getBrandWCPayRequest();
        WeixinJSBridge.invoke('getBrandWCPayRequest', /*{
                         "appId": 'appId',                  //公众号名称，由商户传入
                         "timeStamp": 'timeStamp',          //时间戳，自1970年以来的秒数
                         "nonceStr": 'nonceStr',            //随机串
                         "package": 'package',              //订单详情
                         "signType": 'signType',            //微信签名方式:
                         "paySign": 'paySign'               //微信签名
                    }*/wechat_data, (res) => {
            //console.log('res', res);
            if (res.err_msg == "get_brand_wcpay_request:ok") {
                //window.location.replace("user_index.html");
                getStatus = setInterval(() => {
                    $.ajax({
                        type: 'get',
                        url: '',
                        dataType: 'json',
                        success: function(resp){
                            console.log('data', resp);
                            if( resp && resp.data.status == 'success' ){
                                clearInterval(getStatus);
                                $.alert('操作成功！');
                            }
                        },
                        error: function (data) {
                            $.toast(data.status, "text");
                        }
                    });
                }, 3000);
            } /*else if (res.err_msg == "get_brand_wcpay_request:cancel") {
                              alert("取消支付!");
                         } else {
                              alert("支付失败!");
                         }*/
        } /*function(res){
                         if(res.err_msg == "get_brand_wcpay_request:ok"){
                              window.location.replace("user_index.html")
                         }else if(res.err_msg == "get_brand_wcpay_request:cancel"){
                              alert("取消支付!");
                         }else{
                              alert("支付失败!");
                         }
                    }*/);
    }
</script>

</html>